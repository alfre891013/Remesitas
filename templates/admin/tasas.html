{% extends "base.html" %}

{% block title %}Tasas de Cambio - Remesitas{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h4><i class="bi bi-currency-exchange"></i> Tasas de Cambio</h4>
</div>

<!-- Panel Informativo de las 3 Tasas -->
<div class="row mb-4">
    <div class="col-md-4">
        <div class="card border-success h-100">
            <div class="card-header bg-success text-white text-center">
                <h5 class="mb-0"><i class="bi bi-currency-dollar"></i> USD</h5>
            </div>
            <div class="card-body text-center">
                <h1 class="display-4 text-success mb-0">{{ tasa_usd }}</h1>
                <p class="text-muted mb-0">CUP por Dolar</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card border-primary h-100">
            <div class="card-header bg-primary text-white text-center">
                <h5 class="mb-0"><i class="bi bi-currency-euro"></i> EUR</h5>
            </div>
            <div class="card-body text-center">
                <h1 class="display-4 text-primary mb-0">{{ tasa_eur }}</h1>
                <p class="text-muted mb-0">CUP por Euro</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card border-warning h-100">
            <div class="card-header bg-warning text-dark text-center">
                <h5 class="mb-0"><i class="bi bi-credit-card"></i> MLC</h5>
            </div>
            <div class="card-body text-center">
                <h1 class="display-4 text-warning mb-0">{{ tasa_mlc }}</h1>
                <p class="text-muted mb-0">CUP por MLC</p>
            </div>
        </div>
    </div>
</div>

<!-- Actualizar Tasas -->
<div class="card mb-4">
    <div class="card-header">
        <h5 class="mb-0"><i class="bi bi-pencil-square"></i> Actualizar Tasas</h5>
    </div>
    <div class="card-body">
        <form method="POST" action="{{ url_for('admin.tasas_actualizar_todas') }}">
            <div class="row g-3">
                <div class="col-md-4">
                    <label class="form-label fw-bold text-success">USD</label>
                    <div class="input-group">
                        <span class="input-group-text">1 USD =</span>
                        <input type="number" name="tasa_usd" class="form-control" step="0.01" min="0.01" value="{{ tasa_usd }}" required>
                        <span class="input-group-text">CUP</span>
                    </div>
                </div>
                <div class="col-md-4">
                    <label class="form-label fw-bold text-primary">EUR</label>
                    <div class="input-group">
                        <span class="input-group-text">1 EUR =</span>
                        <input type="number" name="tasa_eur" class="form-control" step="0.01" min="0.01" value="{{ tasa_eur }}" required>
                        <span class="input-group-text">CUP</span>
                    </div>
                </div>
                <div class="col-md-4">
                    <label class="form-label fw-bold text-warning">MLC</label>
                    <div class="input-group">
                        <span class="input-group-text">1 MLC =</span>
                        <input type="number" name="tasa_mlc" class="form-control" step="0.01" min="0.01" value="{{ tasa_mlc }}" required>
                        <span class="input-group-text">CUP</span>
                    </div>
                </div>
            </div>
            <div class="mt-3 text-end">
                <button type="submit" class="btn btn-primary btn-lg">
                    <i class="bi bi-check-lg"></i> Guardar Tasas
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Referencia -->
<div class="alert alert-info">
    <i class="bi bi-info-circle"></i> Referencia: 
    <a href="https://eltoque.com/tasas-de-cambio-de-moneda-en-cuba-hoy" target="_blank">El Toque</a>
    - Las tasas se actualizan automaticamente cada 12 horas
</div>

<!-- Historial -->
<div class="card">
    <div class="card-header">
        <h5 class="mb-0"><i class="bi bi-clock-history"></i> Historial</h5>
    </div>
    <div class="card-body p-0">
        <table class="table table-hover mb-0">
            <thead class="table-light">
                <tr><th>Fecha</th><th>Moneda</th><th>Tasa</th><th>Estado</th></tr>
            </thead>
            <tbody>
                {% for tasa in tasas %}
                <tr>
                    <td>{{ tasa.fecha_actualizacion.strftime('%d/%m/%Y %H:%M') }}</td>
                    <td>
                        {% if tasa.moneda_origen == 'USD' %}<span class="badge bg-success">USD</span>
                        {% elif tasa.moneda_origen == 'EUR' %}<span class="badge bg-primary">EUR</span>
                        {% elif tasa.moneda_origen == 'MLC' %}<span class="badge bg-warning text-dark">MLC</span>
                        {% else %}<span class="badge bg-secondary">{{ tasa.moneda_origen }}</span>{% endif %}
                    </td>
                    <td>1 {{ tasa.moneda_origen }} = <strong>{{ tasa.tasa }}</strong> CUP</td>
                    <td>
                        {% if tasa.activa %}<span class="badge bg-success">Activa</span>
                        {% else %}<span class="badge bg-secondary">Anterior</span>{% endif %}
                    </td>
                </tr>
                {% else %}
                <tr><td colspan="4" class="text-center py-3 text-muted">Sin historial</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
